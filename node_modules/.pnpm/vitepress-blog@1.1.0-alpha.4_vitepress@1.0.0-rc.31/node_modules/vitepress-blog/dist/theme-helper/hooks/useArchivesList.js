/*! 
 * vitepress-blog v1.1.0-alpha.3
 * (c) yue1123
 * Homepage: https://github.com/yue1123/vitepress-blog
 * Released under the MIT License.
 */
import { computed } from 'vue';
import { usePostListWithPagination } from './usePostListWithPagination.js';

function useArchivesList(option) {
  const { onYearAppend, onMonthAppend } = option || {};
  const { allPostList } = usePostListWithPagination();
  const data = /* @__PURE__ */ Object.create(null);
  return computed(() => {
    for (const post of allPostList.value) {
      const { createTime } = post;
      const _createTime = new Date(createTime);
      const year = _createTime.getUTCFullYear();
      const month = _createTime.getMonth() + 1;
      let addYearItemFlag = false;
      if (!data[year]) {
        data[year] = {};
        addYearItemFlag = true;
      }
      if (!data[year][month]) {
        data[year][month] = [];
        let _monthList = data[year][month];
        if (addYearItemFlag && onYearAppend) {
          _monthList.push(onYearAppend(year));
        }
        onMonthAppend && _monthList.push(onMonthAppend(month));
      }
      post.type = "post";
      data[year][month].push(post);
    }
    let archivesList = [];
    for (const yearItem of Object.values(data)) {
      for (const monthItem of Object.values(yearItem)) {
        archivesList.push.apply(archivesList, monthItem);
      }
    }
    return archivesList;
  });
}

export { useArchivesList };
